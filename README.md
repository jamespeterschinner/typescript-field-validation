# typescript-field-validation

[![Build Status](https://travis-ci.com/jamespeterschinner/typescript-field-validation.svg?branch=master)](https://travis-ci.com/jamespeterschinner/typescript-field-validation)

Simple to use tool for basic `NonNullable` field validation when parsing data from an API.

If you have auto-generated TS types from an openAPI schema, it's likely that many fields your application requires are defined as optional in the specification.

There are two tools exposed in this library which are designed to work together. The first tool is a conditional type `SetRequired` which allows you to take the types generated from the schema (which contain optional fields) and declare specific fields to be `Required`. The second tool is a generic function `validate` which returns a `Result` that either contains the missing field or the validated type. `SetRequired` and `validate` both take a `readonly string[]` as their second argument which is an array of required fields. This commonality allows you to declare the data your application expects once, and provides you with both the types and means to validate those types.



## Syntax

To specify a field as being required simply use that fields name. To specify a sub field on a field use dot notation `field.subField`. To specify a required field for every object in a field that is an array use `[]`. For example `fieldOne[].subField` would mean that `fieldOne` is an array and every member of that array needs to have a `subField`. 

The array notation is only required when accessing a subField on that array, meaning that if an object has a field `a` which is an array, then there is no need to indicate this with the array notation.

<br/>

## Example usage

<br/>

```typescript
import { validate, SetRequired } from "typescript-field-validation";

type AutoGeneratedSchemaType = {
  id?: string;
  item?: {
    items?: { id?: string; value: any | null }[];
  };
  link?: string;
};

const requiredFields = ["id", "item.items[].id", "item.items[].value"] as const;

type ValidSchemaType = SetRequired<
  AutoGeneratedSchemaType,
  typeof requiredFields[number]
>;

const invalidDataFromAPI = {
  id: "12345",
  item: {
    items: [{ value: "hello world" }],
  },
};

const result1 = validate(invalidDataFromAPI, requiredFields);

// { invalidFields: [ 'item.items[0].id is missing' ], validType: null }

const validDataFromAPI = {
  id: "12345",
  item: {
    items: [{ id: "myId", value: "hello world" }],
  },
};

const result2: ValidSchemaType = validate(
  validDataFromAPI,
  requiredFields
).validType;

```
<br/>

---
<br/>

###### A note of warning: This tool does not check that the values of the required fields are of the type defined by the base schema, this is assumed to be correct. Rather, it simply removes undefined and null from a field's union type.

<br>

---
<br/>

## CHANGELOG

<br/>

- 1.1.0:
  Improve error messages and add additional checks for object vs array fields

- 1.0.1:
  Update readme
